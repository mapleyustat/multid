#!/bin/sh

prog=tBlockTri2per
out=/tmp/"$prog$$.out"
correct_out=/tmp/"$prog$$correct.out"
abserr=1.e-10

cat > "$correct_out" << "END"
M before:
lower:
-0.4 -0.04
-0.04 -0.4
-0.4 -0.04
-0.04 -0.4
-0.4 -0.04
-0.04 -0.4
-0.4 -0.04
-0.04 -0.4
-0.4 -0.04
-0.04 -0.4
-0.4 -0.04
-0.04 -0.4
diag:
1 0
0 1
1 0
0 1
1 0
0 1
1 0
0 1
1 0
0 1
1 0
0 1
upper:
-0.4 0.04
0.04 -0.4
-0.4 0.04
0.04 -0.4
-0.4 0.04
0.04 -0.4
-0.4 0.04
0.04 -0.4
-0.4 0.04
0.04 -0.4
-0.4 0.04
0.04 -0.4
y before:
0.866025 0.5
0.866025 -0.5
0 -1
-0.866025 -0.5
-0.866025 0.5
0 1
M after:
lower:
-0.4 -0.04
-0.04 -0.4
-0.192015 -0.0380228
-0.0380228 -0.192015
-0.0964871 -0.0281967
-0.0281967 -0.0964871
-0.0493527 -0.0188081
-0.0188081 -0.0493527
-0.4 -0.04
-0.04 -0.4
-0.4 -0.04
-0.04 -0.4
diag:
1 0
0 1
0.8416 0
0 0.8416
0.811787 0
0 0.811787
0.804875 0
0 0.804875
0.803199 0
0 0.803199
0.58422 0
0 0.58422
upper:
-0.4 0.04
0.04 -0.4
-0.4 0.04
0.04 -0.4
-0.475285 0.0475285
0.0475285 -0.475285
-0.49274 0.049274
0.049274 -0.49274
-0.496972 0.0496972
0.0496972 -0.496972
-0.4 0.04
0.04 -0.4
y after:
0.866025 0.5
1.4644 -0.315303
0.70603 -1.31506
-0.790453 -1.23967
-1.53361 -0.0342219
0 0.849934
x:
1.58886 0.727409
1.58886 -0.727409
0 -1.45482
-1.58886 -0.727409
-1.58886 0.727409
0 1.45482
M*x:
0.866025 0.5
0.866025 -0.5
0 -1
-0.866025 -0.5
-0.866025 0.5
0 1
M*x - y_before:
0 0
0 0
0 0
0 0
0 0
0 0
END
"$prog" > "$out"
if ndiff -abserr $abserr "$correct_out" "$out" > /dev/null 2>&1; then
	rm -f "$correct_out" "$out"
	exit 0
fi
exit 1
